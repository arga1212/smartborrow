{% extends 'base.html' %}
{% block title %}Dashboard - Asistio{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Selamat Datang, {{ current_user.nama }}!</h1>
    <a href="{{ url_for('pinjam') }}" class="btn btn-primary"><i class="bi bi-plus-circle-fill me-2"></i>Buat Peminjaman Baru</a>
</div>
<div class="card"><div class="card-header"><h4 class="card-title mb-0">Riwayat Peminjaman</h4></div>
<div class="card-body"><div class="table-responsive">
<table class="table table-hover align-middle">
<thead><tr>
    <th>Nama Acara</th><th>Tgl Pinjam</th>
    {% if current_user.role == 'guru' %}<th>Peminjam</th>{% endif %}
    <th>Status</th><th>Aksi</th>
</tr></thead>
<tbody>
{% for peminjaman in peminjaman_list %}
<tr>
    <td><strong>{{ peminjaman.nama_acara }}</strong></td>
    <td>{{ peminjaman.tanggal_pinjam.strftime('%d %b %Y') }}</td>
    {% if current_user.role == 'guru' %}<td>{{ peminjaman.peminjam.nama }}</td>{% endif %}
    <td><span class="badge rounded-pill p-2 status-{{ peminjaman.status.split(' ')[0] }}">{{ peminjaman.status }}</span></td>
    <td>
    {% if current_user.role == 'guru' and peminjaman.status == 'Menunggu Persetujuan' %}
        <form action="{{ url_for('setujui_peminjaman', id=peminjaman.id) }}" method="POST" class="d-inline"><button type="submit" class="btn btn-success btn-sm">Setujui</button></form>
        <form action="{{ url_for('tolak_peminjaman', id=peminjaman.id) }}" method="POST" class="d-inline"><button type="submit" class="btn btn-danger btn-sm">Tolak</button></form>
    {% else %}
        <button class="btn btn-secondary btn-sm" disabled>Detail</button>
    {% endif %}
    </td>
</tr>
{% else %}
<tr><td colspan="5" class="text-center">Belum ada riwayat peminjaman.</td></tr>
{% endfor %}
</tbody></table>
</div></div></div>
{% endblock %}